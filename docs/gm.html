<!DOCTYPE html>
<html lang="en">
<head>
    <!-- File Path: /docs/gm.html -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GM COMMAND CENTER // INTELLIGENCE NETWORK</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;600;700&display=swap');
        
        :root {
            --primary-bg: #0a0b0d;
            --secondary-bg: #1a1d23;
            --tertiary-bg: #252830;
            --accent-red: #ff3366;
            --accent-amber: #ffa500;
            --accent-blue: #00d4ff;
            --accent-green: #00ff88;
            --text-primary: #ffffff;
            --text-secondary: #b8bcc8;
            --text-muted: #6c7293;
            --border-color: #3d4147;
            --glow-red: 0 0 20px rgba(255, 51, 102, 0.3);
            --glow-blue: 0 0 20px rgba(0, 212, 255, 0.3);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Rajdhani', sans-serif;
            background: var(--primary-bg);
            color: var(--text-primary);
            overflow-x: hidden;
            min-height: 100vh;
            background-image: 
                radial-gradient(circle at 20% 50%, rgba(255, 51, 102, 0.03) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(0, 212, 255, 0.03) 0%, transparent 50%);
        }
        
        .header {
            background: linear-gradient(135deg, var(--secondary-bg) 0%, var(--tertiary-bg) 100%);
            border-bottom: 2px solid var(--accent-red);
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 1000;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.8);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1600px;
            margin: 0 auto;
        }
        
        .logo {
            font-family: 'Orbitron', monospace;
            font-size: 1.8rem;
            font-weight: 900;
            color: var(--accent-red);
            text-shadow: var(--glow-red);
            letter-spacing: 2px;
        }
        
        .nav-links {
            display: flex;
            gap: 1rem;
            align-items: center;
        }
        
        .nav-link {
            padding: 0.5rem 1rem;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .nav-link:hover {
            border-color: var(--accent-blue);
            color: var(--accent-blue);
            box-shadow: var(--glow-blue);
        }
        
        .nav-link.active {
            background: rgba(255, 51, 102, 0.1);
            border-color: var(--accent-red);
            color: var(--accent-red);
            box-shadow: var(--glow-red);
        }
        
        .header-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .auth-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 6px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .auth-status.authenticated {
            color: var(--accent-green);
            border: 1px solid var(--accent-green);
        }
        
        .auth-status.unauthenticated {
            color: var(--accent-red);
            border: 1px solid var(--accent-red);
        }
        
        .auth-status:hover {
            box-shadow: 0 0 15px rgba(255, 51, 102, 0.3);
        }
        
        .tab-nav {
            display: flex;
            gap: 0.5rem;
        }
        
        .tab-btn {
            padding: 0.5rem 1rem;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-secondary);
            cursor: pointer;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
        }
        
        .tab-btn:hover, .tab-btn.active {
            border-color: var(--accent-blue);
            color: var(--accent-blue);
            box-shadow: var(--glow-blue);
        }
        
        .main-container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }
        
        .panel {
            background: linear-gradient(135deg, var(--secondary-bg) 0%, var(--tertiary-bg) 100%);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(10px);
            position: relative;
        }
        
        .panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--accent-red), transparent);
        }
        
        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 1rem;
        }
        
        .panel-title {
            font-family: 'Orbitron', monospace;
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--accent-red);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 6px;
            font-family: 'Rajdhani', sans-serif;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--accent-red), #cc1144);
            color: white;
            border: 1px solid var(--accent-red);
        }
        
        .btn-primary:hover:not(:disabled) {
            box-shadow: var(--glow-red);
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: rgba(255, 165, 0, 0.1);
            color: var(--accent-amber);
            border: 1px solid var(--accent-amber);
        }
        
        .btn-success {
            background: rgba(0, 255, 136, 0.1);
            color: var(--accent-green);
            border: 1px solid var(--accent-green);
        }
        
        .btn-blue {
            background: linear-gradient(135deg, var(--accent-blue), #0099cc);
            color: white;
            border: 1px solid var(--accent-blue);
        }
        
        .btn-blue:hover:not(:disabled) {
            box-shadow: var(--glow-blue);
            transform: translateY(-2px);
        }
        
        .quick-action-card {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .quick-action-card:hover {
            border-color: var(--accent-red);
            box-shadow: 0 4px 20px rgba(255, 51, 102, 0.2);
        }
        
        .quick-action-card.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .quick-action-title {
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }
        
        .quick-action-desc {
            color: var(--text-muted);
            font-size: 0.9rem;
        }
        
        .form-group {
            margin-bottom: 1rem;
        }
        
        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 0.9rem;
        }
        
        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 0.75rem;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-primary);
            font-family: 'Rajdhani', sans-serif;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--accent-red);
            box-shadow: 0 0 10px rgba(255, 51, 102, 0.2);
        }
        
        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .stats-input-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: linear-gradient(135deg, var(--secondary-bg) 0%, var(--tertiary-bg) 100%);
            border: 2px solid var(--accent-red);
            border-radius: 12px;
            padding: 2rem;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 1rem;
        }
        
        .modal-title {
            font-family: 'Orbitron', monospace;
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--accent-red);
        }
        
        .close-btn {
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 1.5rem;
            cursor: pointer;
            transition: color 0.3s ease;
        }
        
        .close-btn:hover {
            color: var(--accent-red);
        }
        
        .asset-list, .mission-list {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            margin-bottom: 0.5rem;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .list-item:hover {
            border-color: var(--accent-red);
        }
        
        .item-name {
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .item-status {
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .status-available { background: rgba(0, 255, 136, 0.2); color: var(--accent-green); }
        .status-deployed { background: rgba(255, 165, 0, 0.2); color: var(--accent-amber); }
        .status-planning { background: rgba(0, 212, 255, 0.2); color: var(--accent-blue); }
        .status-active { background: rgba(255, 165, 0, 0.2); color: var(--accent-amber); }
        
        .auth-warning {
            background: rgba(255, 51, 102, 0.1);
            border: 1px solid var(--accent-red);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            text-align: center;
        }
        
        .notification {
            position: fixed;
            top: 100px;
            right: 20px;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            z-index: 3000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            background: var(--accent-green);
        }
        
        .notification.error {
            background: var(--accent-red);
        }
        
        .notification.warning {
            background: var(--accent-amber);
        }
        
        .password-check {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .password-check.hidden {
            display: none;
        }
        
        .password-form {
            background: linear-gradient(135deg, var(--secondary-bg) 0%, var(--tertiary-bg) 100%);
            border: 2px solid var(--accent-red);
            border-radius: 12px;
            padding: 2rem;
            max-width: 400px;
            width: 90%;
            text-align: center;
        }
        
        /* Asset Editor Specific Styles */
        .asset-editor-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 3000;
            overflow-y: auto;
            padding: 2rem;
        }
        
        .asset-editor-modal.active {
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }
        
        .asset-editor-content {
            background: linear-gradient(135deg, var(--secondary-bg) 0%, var(--tertiary-bg) 100%);
            border: 2px solid var(--accent-blue);
            border-radius: 12px;
            padding: 2rem;
            max-width: 1200px;
            width: 100%;
            margin-top: 2rem;
        }
        
        .editor-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-top: 1rem;
        }
        
        .form-section {
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
        }
        
        .stat-input {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .stat-value {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent-blue), #0099cc);
            border: 2px solid var(--accent-blue);
            color: white;
            font-size: 1.1rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 0.5rem;
        }
        
        .stat-slider {
            width: 100%;
            margin-bottom: 0.5rem;
        }
        
        .selected-asset-tag {
            display: inline-block;
            background: var(--accent-green);
            color: var(--primary-bg);
            padding: 0.25rem 0.5rem;
            margin: 0.25rem;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        @media (max-width: 1200px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .nav-links {
                flex-wrap: wrap;
                gap: 0.5rem;
            }
            
            .editor-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Password Check Overlay -->
    <div class="password-check" id="passwordCheck">
        <div class="password-form">
            <div style="margin-bottom: 1.5rem;">
                <h2 style="color: var(--accent-red); font-family: 'Orbitron', monospace; margin-bottom: 0.5rem;">
                    <i class="fas fa-lock"></i> GM ACCESS REQUIRED
                </h2>
                <p style="color: var(--text-secondary);">Enter password to access Game Master controls</p>
            </div>
            <div style="margin-bottom: 1.5rem;">
                <input type="password" id="passwordInput" placeholder="Enter GM Password" 
                       style="width: 100%; padding: 1rem; background: rgba(0, 0, 0, 0.3); border: 1px solid var(--border-color); border-radius: 6px; color: var(--text-primary); font-family: 'Rajdhani', sans-serif; font-size: 1rem; text-align: center;">
            </div>
            <div style="display: flex; gap: 1rem;">
                <button onclick="checkPassword()" class="btn btn-primary" style="flex: 1;">
                    <i class="fas fa-unlock"></i> Access
                </button>
                <button onclick="goToPlayer()" class="btn btn-secondary">
                    <i class="fas fa-arrow-left"></i> Back to Player
                </button>
            </div>
        </div>
    </div>

    <header class="header">
        <div class="header-content">
            <div class="logo">
                <i class="fas fa-cog"></i> GM COMMAND CENTER
            </div>
            <nav class="nav-links">
                <a href="index.html" class="nav-link">Player Interface</a>
                <a href="intelligence-management.html" class="nav-link">Intelligence Manager</a>
                <span class="nav-link active">GM Access</span>
            </nav>
            <div class="header-controls">
                <div class="auth-status" id="authStatus" onclick="handleAuthClick()">
                    <i class="fas fa-lock"></i>
                    <span>Checking Auth...</span>
                </div>
                <div class="tab-nav">
                    <div class="tab-btn active" onclick="switchTab('dashboard')">Dashboard</div>
                    <div class="tab-btn" onclick="switchTab('assets')">Assets</div>
                    <div class="tab-btn" onclick="switchTab('missions')">Missions</div>
                    <div class="tab-btn" onclick="switchTab('treasury')">Treasury</div>
                </div>
            </div>
        </div>
    </header>
    
    <div class="main-container">
        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <div id="authWarning" class="auth-warning" style="display: none;">
                <h3 style="color: var(--accent-red); margin-bottom: 0.5rem;">
                    <i class="fas fa-exclamation-triangle"></i> Authentication Required
                </h3>
                <p style="margin-bottom: 1rem;">To create assets, missions, and modify game data, you need to authenticate with GitHub.</p>
                <button class="btn btn-primary" onclick="showTokenModal()">
                    <i class="fas fa-key"></i> Add GitHub Token
                </button>
            </div>
            
            <div class="dashboard-grid">
                <div class="panel">
                    <div class="panel-header">
                        <h2 class="panel-title"><i class="fas fa-bolt"></i> Quick Actions</h2>
                        <button class="btn btn-secondary" onclick="refreshAllData()">
                            <i class="fas fa-sync"></i> Refresh
                        </button>
                    </div>
                    
                    <div class="quick-action-card" onclick="checkAuthAndRun(() => editAsset('new'))">
                        <div class="quick-action-title">Create New Asset</div>
                        <div class="quick-action-desc">Recruit a new intelligence operative</div>
                    </div>
                    
                    <div class="quick-action-card" onclick="checkAuthAndRun(() => openModal('missionModal'))">
                        <div class="quick-action-title">Create New Mission</div>
                        <div class="quick-action-desc">Plan a new intelligence operation</div>
                    </div>
                    
                    <div class="quick-action-card" onclick="checkAuthAndRun(processPayroll)">
                        <div class="quick-action-title">Process Monthly Payroll</div>
                        <div class="quick-action-desc">Deduct monthly costs from treasury</div>
                    </div>
                    
                    <div class="quick-action-card" onclick="checkAuthAndRun(() => openModal('treasuryModal'))">
                        <div class="quick-action-title">Adjust Treasury</div>
                        <div class="quick-action-desc">Add/remove funds from network budget</div>
                    </div>
                    
                    <div class="quick-action-card" onclick="generateRandomEvent()">
                        <div class="quick-action-title">Generate Random Event</div>
                        <div class="quick-action-desc">Create story complications or opportunities</div>
                    </div>
                </div>
                
                <div class="panel">
                    <div class="panel-header">
                        <h2 class="panel-title"><i class="fas fa-clock"></i> Active Operations</h2>
                    </div>
                    
                    <div id="activeMissionsContainer">
                        <div style="text-align: center; color: var(--text-muted); padding: 2rem;">
                            <i class="fas fa-satellite-dish fa-spin fa-2x"></i>
                            <p style="margin-top: 1rem;">Loading active operations...</p>
                        </div>
                    </div>
                </div>
                
                <div class="panel">
                    <div class="panel-header">
                        <h2 class="panel-title"><i class="fas fa-users-cog"></i> Asset Status</h2>
                    </div>
                    
                    <div id="assetStatusContainer">
                        <div style="text-align: center; color: var(--text-muted); padding: 2rem;">
                            <i class="fas fa-satellite-dish fa-spin fa-2x"></i>
                            <p style="margin-top: 1rem;">Loading asset status...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Assets Tab -->
        <div id="assets" class="tab-content">
            <div class="panel">
                <div class="panel-header">
                    <h2 class="panel-title"><i class="fas fa-users"></i> Asset Management</h2>
                    <button class="btn btn-primary" onclick="checkAuthAndRun(() => editAsset('new'))">
                        <i class="fas fa-plus"></i> Create Asset
                    </button>
                </div>
                
                <div class="asset-list" id="assetManagementList">
                    <div style="text-align: center; color: var(--text-muted); padding: 2rem;">
                        <i class="fas fa-satellite-dish fa-spin fa-2x"></i>
                        <p style="margin-top: 1rem;">Loading assets...</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Missions Tab -->
        <div id="missions" class="tab-content">
            <div class="panel">
                <div class="panel-header">
                    <h2 class="panel-title"><i class="fas fa-crosshairs"></i> Mission Management</h2>
                    <button class="btn btn-primary" onclick="checkAuthAndRun(() => openModal('missionModal'))">
                        <i class="fas fa-plus"></i> Create Mission
                    </button>
                </div>
                
                <div class="mission-list" id="missionManagementList">
                    <div style="text-align: center; color: var(--text-muted); padding: 2rem;">
                        <i class="fas fa-satellite-dish fa-spin fa-2x"></i>
                        <p style="margin-top: 1rem;">Loading missions...</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Treasury Tab -->
        <div id="treasury" class="tab-content">
            <div class="panel">
                <div class="panel-header">
                    <h2 class="panel-title"><i class="fas fa-dollar-sign"></i> Treasury Management</h2>
                    <div>
                        <button class="btn btn-secondary" onclick="checkAuthAndRun(processPayroll)" style="margin-right: 1rem;">
                            <i class="fas fa-calculator"></i> Process Payroll
                        </button>
                        <button class="btn btn-primary" onclick="checkAuthAndRun(() => openModal('treasuryModal'))">
                            <i class="fas fa-plus"></i> Adjust Funds
                        </button>
                    </div>
                </div>
                
                <div id="treasuryDisplay">
                    <div style="text-align: center; color: var(--text-muted); padding: 2rem;">
                        <i class="fas fa-satellite-dish fa-spin fa-2x"></i>
                        <p style="margin-top: 1rem;">Loading treasury data...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Asset Creation Modal -->
    <div class="modal" id="assetModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Create New Asset</h3>
                <button class="close-btn" onclick="closeModal('assetModal')">&times;</button>
            </div>
            
            <form id="assetForm" onsubmit="createNewAsset(event)">
                <div class="form-group">
                    <label class="form-label">Asset Name</label>
                    <input type="text" name="real_name" class="form-input" placeholder="Marcus Blackthorne" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Codename</label>
                    <input type="text" name="codename" class="form-input" placeholder="Blackthorne">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Location</label>
                    <select name="realm" class="form-select" required>
                        <option value="Mortal Coil">Mortal Coil</option>
                        <option value="Winter Court">Winter Court - Never Never</option>
                        <option value="Summer Court">Summer Court - Never Never</option>
                        <option value="Hell">Hell</option>
                        <option value="Abyss">Abyss</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Region</label>
                    <input type="text" name="region" class="form-input" placeholder="Chicago, Illinois">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Stats (1-10)</label>
                    <div class="stats-input-grid">
                        <div>
                            <label class="form-label" style="margin-bottom: 0.25rem;">Skill</label>
                            <input type="number" name="skill" class="form-input" min="1" max="10" value="5" required>
                        </div>
                        <div>
                            <label class="form-label" style="margin-bottom: 0.25rem;">Stealth</label>
                            <input type="number" name="stealth" class="form-input" min="1" max="10" value="5" required>
                        </div>
                        <div>
                            <label class="form-label" style="margin-bottom: 0.25rem;">Combat</label>
                            <input type="number" name="combat" class="form-input" min="1" max="10" value="5" required>
                        </div>
                        <div>
                            <label class="form-label" style="margin-bottom: 0.25rem;">Tech</label>
                            <input type="number" name="tech" class="form-input" min="1" max="10" value="5" required>
                        </div>
                        <div>
                            <label class="form-label" style="margin-bottom: 0.25rem;">Social</label>
                            <input type="number" name="social" class="form-input" min="1" max="10" value="5" required>
                        </div>
                        <div>
                            <label class="form-label" style="margin-bottom: 0.25rem;">Will</label>
                            <input type="number" name="will" class="form-input" min="1" max="10" value="5" required>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Monthly Salary ($)</label>
                    <input type="number" name="monthly_salary" class="form-input" placeholder="2500" value="2500">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea name="description" class="form-textarea" placeholder="Background, abilities, and quirks..."></textarea>
                </div>
                
                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    <i class="fas fa-plus"></i> Create Asset
                </button>
            </form>
        </div>
    </div>
    
    <!-- Mission Creation Modal -->
    <div class="modal" id="missionModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Create New Mission</h3>
                <button class="close-btn" onclick="closeModal('missionModal')">&times;</button>
            </div>
            
            <form id="missionForm" onsubmit="createNewMission(event)">
                <div class="form-group">
                    <label class="form-label">Mission Codename</label>
                    <input type="text" name="codename" class="form-input" placeholder="OPERATION NIGHTFALL" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Classification</label>
                    <select name="classification" class="form-select" required>
                        <option value="CLASSIFIED">CLASSIFIED</option>
                        <option value="SECRET">SECRET</option>
                        <option value="TOP SECRET">TOP SECRET</option>
                        <option value="EYES ONLY">EYES ONLY</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Primary Objective</label>
                    <textarea name="primary_objective" class="form-textarea" placeholder="Infiltrate target location and gather intelligence..." required></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Target Realm</label>
                    <input type="text" name="target_realm" class="form-input" placeholder="Chicago Outfit Headquarters" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Risk Level</label>
                    <select name="risk_level" class="form-select" required>
                        <option value="LOW">LOW</option>
                        <option value="MEDIUM" selected>MEDIUM</option>
                        <option value="HIGH">HIGH</option>
                        <option value="EXTREME">EXTREME</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Estimated Duration (Hours)</label>
                    <input type="number" name="duration_hours" class="form-input" placeholder="72" value="72" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Mission Status</label>
                    <select name="mission_status" class="form-select" required>
                        <option value="PLANNING">PLANNING (Hidden from players)</option>
                        <option value="ACTIVE">ACTIVE (Visible to players)</option>
                    </select>
                </div>
                
                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    <i class="fas fa-plus"></i> Create Mission
                </button>
            </form>
        </div>
    </div>
    
    <!-- Treasury Modal -->
    <div class="modal" id="treasuryModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Adjust Treasury</h3>
                <button class="close-btn" onclick="closeModal('treasuryModal')">&times;</button>
            </div>
            
            <form id="treasuryForm" onsubmit="adjustTreasury(event)">
                <div class="form-group">
                    <label class="form-label">Amount ($)</label>
                    <input type="number" name="amount" class="form-input" placeholder="50000" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Transaction Type</label>
                    <select name="transaction_type" class="form-select" required>
                        <option value="add">Add Funds</option>
                        <option value="subtract">Subtract Funds</option>
                        <option value="set">Set Treasury To</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Reason</label>
                    <input type="text" name="reason" class="form-input" placeholder="Funding from benefactor..." required>
                </div>
                
                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    <i class="fas fa-dollar-sign"></i> Update Treasury
                </button>
            </form>
        </div>
    </div>

    <!-- Asset Editor Modal -->
    <div class="asset-editor-modal" id="assetEditorModal">
        <div class="asset-editor-content">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="fas fa-user-plus"></i> Asset Editor
                </h3>
                <button class="close-btn" onclick="closeAssetEditor()">&times;</button>
            </div>
            
            <!-- Asset Preview -->
            <div class="panel" style="margin-bottom: 1.5rem;">
                <h4 style="color: var(--accent-green); margin-bottom: 1rem;">Live Preview</h4>
                <div id="assetPreviewCard">
                    <!-- Preview will be populated by JavaScript -->
                </div>
            </div>
            
            <form id="assetEditorForm">
                <div class="editor-grid">
                    <!-- Left Column -->
                    <div>
                        <!-- Basic Information -->
                        <div class="form-section">
                            <h4 style="color: var(--accent-blue); margin-bottom: 1rem;">Basic Information</h4>
                            
                            <div class="form-group">
                                <label class="form-label">Real Name</label>
                                <input type="text" id="assetRealName" class="form-input" placeholder="Marcus Chen" onchange="updateAssetPreview()">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Codename</label>
                                <input type="text" id="assetCodename" class="form-input" placeholder="Nightfall" onchange="updateAssetPreview()">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Classification</label>
                                <select id="assetClassification" class="form-select" onchange="updateAssetPreview()">
                                    <option value="CONFIDENTIAL">CONFIDENTIAL</option>
                                    <option value="SECRET">SECRET</option>
                                    <option value="TOP SECRET">TOP SECRET</option>
                                    <option value="EYES ONLY">EYES ONLY</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Image URL (Optional)</label>
                                <input type="url" id="assetImageUrl" class="form-input" placeholder="https://i.imgur.com/..." onchange="updateAssetPreview()">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Description</label>
                                <textarea id="assetDescription" class="form-textarea" rows="3" placeholder="Background, personality, and notable characteristics..." onchange="updateAssetPreview()"></textarea>
                            </div>
                        </div>
                        
                        <!-- Location & Mobility -->
                        <div class="form-section">
                            <h4 style="color: var(--accent-blue); margin-bottom: 1rem;">Location</h4>
                            
                            <div class="form-group">
                                <label class="form-label">Realm</label>
                                <select id="assetRealm" class="form-select" onchange="updateAssetPreview()">
                                    <option value="Mortal Coil">Mortal Coil</option>
                                    <option value="Winter Court">Winter Court - Never Never</option>
                                    <option value="Summer Court">Summer Court - Never Never</option>
                                    <option value="Hell">Hell</option>
                                    <option value="Abyss">Abyss</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Region/City</label>
                                <input type="text" id="assetRegion" class="form-input" placeholder="Chicago, Illinois" onchange="updateAssetPreview()">
                            </div>
                        </div>
                        
                        <!-- Financial -->
                        <div class="form-section">
                            <h4 style="color: var(--accent-blue); margin-bottom: 1rem;">Financial</h4>
                            
                            <div class="form-group">
                                <label class="form-label">Monthly Salary ($)</label>
                                <input type="number" id="assetMonthlySalary" class="form-input" value="2500" min="0" onchange="updateAssetPreview()">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Recruitment Fee ($)</label>
                                <input type="number" id="assetRecruitmentFee" class="form-input" value="5000" min="0">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Right Column -->
                    <div>
                        <!-- Core Stats -->
                        <div class="form-section">
                            <h4 style="color: var(--accent-blue); margin-bottom: 1rem;">Core Stats (1-10)</h4>
                            
                            <div class="stats-grid">
                                <div class="stat-input">
                                    <div class="stat-value" id="assetSkillValue">5</div>
                                    <input type="range" class="stat-slider" id="assetSkill" min="1" max="10" value="5" oninput="updateAssetStatDisplay('skill')" onchange="updateAssetPreview()">
                                    <label class="form-label" style="text-align: center;">Skill</label>
                                </div>
                                
                                <div class="stat-input">
                                    <div class="stat-value" id="assetStealthValue">5</div>
                                    <input type="range" class="stat-slider" id="assetStealth" min="1" max="10" value="5" oninput="updateAssetStatDisplay('stealth')" onchange="updateAssetPreview()">
                                    <label class="form-label" style="text-align: center;">Stealth</label>
                                </div>
                                
                                <div class="stat-input">
                                    <div class="stat-value" id="assetCombatValue">5</div>
                                    <input type="range" class="stat-slider" id="assetCombat" min="1" max="10" value="5" oninput="updateAssetStatDisplay('combat')" onchange="updateAssetPreview()">
                                    <label class="form-label" style="text-align: center;">Combat</label>
                                </div>
                                
                                <div class="stat-input">
                                    <div class="stat-value" id="assetTechValue">5</div>
                                    <input type="range" class="stat-slider" id="assetTech" min="1" max="10" value="5" oninput="updateAssetStatDisplay('tech')" onchange="updateAssetPreview()">
                                    <label class="form-label" style="text-align: center;">Tech</label>
                                </div>
                                
                                <div class="stat-input">
                                    <div class="stat-value" id="assetSocialValue">5</div>
                                    <input type="range" class="stat-slider" id="assetSocial" min="1" max="10" value="5" oninput="updateAssetStatDisplay('social')" onchange="updateAssetPreview()">
                                    <label class="form-label" style="text-align: center;">Social</label>
                                </div>
                                
                                <div class="stat-input">
                                    <div class="stat-value" id="assetWillValue">5</div>
                                    <input type="range" class="stat-slider" id="assetWill" min="1" max="10" value="5" oninput="updateAssetStatDisplay('will')" onchange="updateAssetPreview()">
                                    <label class="form-label" style="text-align: center;">Will</label>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Psychological Profile -->
                        <div class="form-section">
                            <h4 style="color: var(--accent-blue); margin-bottom: 1rem;">Psychological Profile</h4>
                            
                            <div class="form-group">
                                <label class="form-label">Loyalty (1-10): <span id="assetLoyaltyDisplay">8</span></label>
                                <input type="range" id="assetLoyalty" min="1" max="10" value="8" oninput="document.getElementById('assetLoyaltyDisplay').textContent = this.value">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Corruption Resistance (1-10): <span id="assetCorruptionResistDisplay">7</span></label>
                                <input type="range" id="assetCorruptionResist" min="1" max="10" value="7" oninput="document.getElementById('assetCorruptionResistDisplay').textContent = this.value">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Stress Tolerance (1-10): <span id="assetStressToleranceDisplay">6</span></label>
                                <input type="range" id="assetStressTolerance" min="1" max="10" value="6" oninput="document.getElementById('assetStressToleranceDisplay').textContent = this.value">
                            </div>
                        </div>
                        
                        <!-- Specializations -->
                        <div class="form-section">
                            <h4 style="color: var(--accent-blue); margin-bottom: 1rem;">Specializations</h4>
                            
                            <div class="form-group">
                                <input type="text" id="assetNewSpecialization" class="form-input" placeholder="Add specialization (e.g., 'Hacker', 'Linguist')" onkeypress="if(event.key==='Enter'){event.preventDefault();addAssetSpecialization();}">
                                <button type="button" class="btn btn-secondary" onclick="addAssetSpecialization()" style="margin-top: 0.5rem; width: 100%;">
                                    <i class="fas fa-plus"></i> Add Specialization
                                </button>
                            </div>
                            
                            <div id="assetSpecializationsList">
                                <!-- Specializations will be added here -->
                            </div>
                        </div>
                        
                        <!-- Equipment -->
                        <div class="form-section">
                            <h4 style="color: var(--accent-blue); margin-bottom: 1rem;">Equipment</h4>
                            
                            <div class="form-group">
                                <input type="text" id="assetNewEquipment" class="form-input" placeholder="Add equipment (e.g., 'Encrypted Laptop', 'Lockpicks')" onkeypress="if(event.key==='Enter'){event.preventDefault();addAssetEquipment();}">
                                <button type="button" class="btn btn-secondary" onclick="addAssetEquipment()" style="margin-top: 0.5rem; width: 100%;">
                                    <i class="fas fa-plus"></i> Add Equipment
                                </button>
                            </div>
                            
                            <div id="assetEquipmentList">
                                <!-- Equipment will be added here -->
                            </div>
                        </div>
                    </div>
                </div>
            </form>
            
            <!-- Action Buttons -->
            <div style="display: flex; gap: 1rem; margin-top: 2rem; justify-content: center;">
                <button class="btn btn-success" onclick="saveAssetFromEditor()">
                    <i class="fas fa-save"></i> Save Asset
                </button>
                <button class="btn btn-secondary" onclick="closeAssetEditor()">
                    <i class="fas fa-times"></i> Cancel
                </button>
                <button class="btn btn-danger" onclick="deleteCurrentAsset()" style="display: none;" id="deleteAssetBtn">
                    <i class="fas fa-trash"></i> Delete Asset
                </button>
            </div>
        </div>
    </div>
    
    <!-- Load dependencies -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js"></script>
    <script src="js/data-loader.js"></script>
    
    <script>
        // Asset Editor Variables
        let currentEditingAsset = null;
        let assetSpecializations = [];
        let assetEquipment = [];
        
        // Password check on page load
        document.addEventListener('DOMContentLoaded', function() {
            checkGMAccess();
        });
        
        function checkGMAccess() {
            const hasAccess = sessionStorage.getItem('gmAccess') === 'true';
            if (!hasAccess) {
                document.getElementById('passwordCheck').classList.remove('hidden');
                document.getElementById('passwordInput').focus();
            } else {
                document.getElementById('passwordCheck').classList.add('hidden');
                initializeGMInterface();
            }
        }
        
        function checkPassword() {
            const password = document.getElementById('passwordInput').value;
            if (password === 'Lastdrop1@') {
                sessionStorage.setItem('gmAccess', 'true');
                document.getElementById('passwordCheck').classList.add('hidden');
                initializeGMInterface();
            } else {
                alert('Incorrect password. Access denied.');
                document.getElementById('passwordInput').value = '';
                document.getElementById('passwordInput').focus();
            }
        }
        
        function goToPlayer() {
            window.location.href = 'index.html';
        }
        
        async function initializeGMInterface() {
            try {
                updateAuthStatus();
                await loadAllGMData();
                
            } catch (error) {
                console.error('Failed to initialize GM interface:', error);
                showNotification('Failed to load data', 'error');
            }
        }
        
        function updateAuthStatus() {
            const authStatus = document.getElementById('authStatus');
            const authWarning = document.getElementById('authWarning');
            
            if (intelligenceAPI && intelligenceAPI.canWrite()) {
                authStatus.className = 'auth-status authenticated';
                authStatus.innerHTML = '<i class="fas fa-unlock"></i><span>Authenticated</span>';
                authWarning.style.display = 'none';
            } else {
                authStatus.className = 'auth-status unauthenticated';
                authStatus.innerHTML = '<i class="fas fa-lock"></i><span>Read-Only Mode</span>';
                authWarning.style.display = 'block';
            }
        }
        
        function handleAuthClick() {
            if (!intelligenceAPI || !intelligenceAPI.canWrite()) {
                showTokenModal();
            }
        }
        
        function switchTab(tabName) {
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(tabName).classList.add('active');
            
            // Load specific tab data
            if (tabName === 'assets') {
                loadAssetManagement();
            } else if (tabName === 'missions') {
                loadMissionManagement();
            } else if (tabName === 'treasury') {
                loadTreasuryManagement();
            }
        }
        
        async function loadAllGMData() {
            try {
                const [assets, operations, gameState] = await Promise.all([
                    intelligenceAPI.loadAssets(),
                    intelligenceAPI.loadOperations(),
                    intelligenceAPI.loadGameState()
                ]);
                
                await Promise.all([
                    loadDashboardData(assets, operations, gameState),
                    loadAssetManagement(),
                    loadMissionManagement(),
                    loadTreasuryManagement()
                ]);
                
                console.log('All GM data loaded successfully');
                
            } catch (error) {
                console.error('Failed to load GM data:', error);
                showNotification('Failed to load GM data', 'error');
            }
        }
        
        async function loadDashboardData(assets, operations, gameState) {
            // Load active missions
            const activeMissions = operations.filter(op => op.deployment?.status === 'ACTIVE');
            const activeMissionsContainer = document.getElementById('activeMissionsContainer');
            
            if (activeMissions.length === 0) {
                activeMissionsContainer.innerHTML = `
                    <div style="text-align: center; color: var(--text-muted); padding: 2rem;">
                        <i class="fas fa-clock"></i>
                        <p style="margin-top: 0.5rem;">No active operations</p>
                    </div>
                `;
            } else {
                activeMissionsContainer.innerHTML = activeMissions.map(mission => `
                    <div class="list-item">
                        <div>
                            <div class="item-name">${mission.codename}</div>
                            <div style="font-size: 0.8rem; color: var(--text-muted);">${mission.deployment?.assigned_assets?.length || 0} assets deployed</div>
                        </div>
                        <div class="item-status status-active">ACTIVE</div>
                    </div>
                `).join('');
            }
            
            // Load asset status summary
            const assetStatusContainer = document.getElementById('assetStatusContainer');
            const statusCounts = {
                available: assets.filter(a => a.status?.current === 'available').length,
                deployed: assets.filter(a => a.status?.current === 'deployed').length,
                injured: assets.filter(a => a.status?.current === 'injured').length
            };
            
            assetStatusContainer.innerHTML = `
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem; text-align: center;">
                    <div>
                        <div style="font-size: 1.5rem; font-weight: 700; color: var(--accent-green);">${statusCounts.available}</div>
                        <div style="font-size: 0.8rem; color: var(--text-muted);">Available</div>
                    </div>
                    <div>
                        <div style="font-size: 1.5rem; font-weight: 700; color: var(--accent-amber);">${statusCounts.deployed}</div>
                        <div style="font-size: 0.8rem; color: var(--text-muted);">Deployed</div>
                    </div>
                    <div>
                        <div style="font-size: 1.5rem; font-weight: 700; color: var(--accent-red);">${statusCounts.injured}</div>
                        <div style="font-size: 0.8rem; color: var(--text-muted);">Injured</div>
                    </div>
                </div>
            `;
        }
        
        async function loadAssetManagement() {
            try {
                const assets = await intelligenceAPI.loadAssets();
                const container = document.getElementById('assetManagementList');
                
                // Add "Create New Asset" button at the top
                container.innerHTML = `
                    <div class="list-item" onclick="editAsset('new')" style="border: 2px dashed var(--accent-green); background: rgba(0, 255, 136, 0.1); cursor: pointer;">
                        <div>
                            <div class="item-name" style="color: var(--accent-green);">
                                <i class="fas fa-plus"></i> Create New Asset
                            </div>
                            <div style="font-size: 0.8rem; color: var(--text-muted);">
                                Add a new operative to your network
                            </div>
                        </div>
                        <div class="item-status" style="background: var(--accent-green); color: var(--primary-bg);">NEW</div>
                    </div>
                `;
                
                if (assets.length === 0) {
                    container.innerHTML += `
                        <div style="text-align: center; color: var(--text-muted); padding: 2rem;">
                            <i class="fas fa-users fa-2x"></i>
                            <p style="margin-top: 1rem;">No assets created yet</p>
                        </div>
                    `;
                    return;
                }
                
                // Add existing assets
                assets.forEach(asset => {
                    const assetElement = document.createElement('div');
                    assetElement.innerHTML = `
                        <div class="list-item" onclick="editAsset('${asset.asset_id}')">
                            <div>
                                <div class="item-name">${asset.real_name || asset.codename}</div>
                                <div style="font-size: 0.8rem; color: var(--text-muted);">
                                    ${asset.location?.realm || 'Unknown'} - $${asset.costs?.monthly_salary || 0}/month
                                </div>
                            </div>
                            <div class="item-status status-${asset.status?.current || 'available'}">${(asset.status?.current || 'available').toUpperCase()}</div>
                        </div>
                    `;
                    container.appendChild(assetElement.firstElementChild);
                });
                
            } catch (error) {
                console.error('Failed to load asset management:', error);
            }
        }
        
        async function loadMissionManagement() {
            try {
                const operations = await intelligenceAPI.loadOperations();
                const container = document.getElementById('missionManagementList');
                
                if (operations.length === 0) {
                    container.innerHTML = `
                        <div style="text-align: center; color: var(--text-muted); padding: 2rem;">
                            <i class="fas fa-crosshairs"></i>
                            <p style="margin-top: 0.5rem;">No missions created yet</p>
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = operations.map(mission => `
                    <div class="list-item" onclick="editMission('${mission.operation_id}')">
                        <div>
                            <div class="item-name">${mission.codename}</div>
                            <div style="font-size: 0.8rem; color: var(--text-muted);">
                                ${mission.target?.location?.realm || 'Unknown target'} - ${mission.risks?.level || 'MEDIUM'} risk
                            </div>
                        </div>
                        <div class="item-status status-${mission.deployment?.status?.toLowerCase() || 'planning'}">${mission.deployment?.status || 'PLANNING'}</div>
                    </div>
                `).join('');
                
            } catch (error) {
                console.error('Failed to load mission management:', error);
            }
        }
        
        async function loadTreasuryManagement() {
            try {
                const [gameState, assets] = await Promise.all([
                    intelligenceAPI.loadGameState(),
                    intelligenceAPI.loadAssets()
                ]);
                
                const currentFunds = gameState.treasury?.current_funds || 0;
                const monthlyIncome = gameState.treasury?.monthly_income || 0;
                const monthlyCosts = assets.reduce((sum, asset) => sum + (asset.costs?.monthly_salary || 0), 0);
                const netIncome = monthlyIncome - monthlyCosts;
                
                const container = document.getElementById('treasuryDisplay');
                container.innerHTML = `
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 2rem;">
                        <div style="text-align: center; padding: 1.5rem; background: rgba(0, 212, 255, 0.1); border-radius: 8px;">
                            <div style="font-size: 2rem; font-weight: 700; color: var(--accent-blue);">$${currentFunds.toLocaleString()}</div>
                            <div style="font-size: 0.9rem; color: var(--text-muted);">Current Treasury</div>
                        </div>
                        <div style="text-align: center; padding: 1.5rem; background: rgba(0, 255, 136, 0.1); border-radius: 8px;">
                            <div style="font-size: 2rem; font-weight: 700; color: ${netIncome >= 0 ? 'var(--accent-green)' : 'var(--accent-red)'};">$${netIncome.toLocaleString()}</div>
                            <div style="font-size: 0.9rem; color: var(--text-muted);">Monthly Net Income</div>
                        </div>
                    </div>
                    
                    <div style="background: rgba(0, 0, 0, 0.3); border-radius: 8px; padding: 1.5rem;">
                        <h3 style="color: var(--accent-amber); margin-bottom: 1rem;">Financial Breakdown</h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                    <span>Monthly Income:</span>
                                    <span style="color: var(--accent-green);">+$${monthlyIncome.toLocaleString()}</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                    <span>Asset Salaries:</span>
                                    <span style="color: var(--accent-red);">-$${monthlyCosts.toLocaleString()}</span>
                                </div>
                                <div style="border-top: 1px solid var(--border-color); padding-top: 0.5rem; display: flex; justify-content: space-between; font-weight: 700;">
                                    <span>Net Monthly:</span>
                                    <span style="color: ${netIncome >= 0 ? 'var(--accent-green)' : 'var(--accent-red)'};">${netIncome >= 0 ? '+' : ''}$${netIncome.toLocaleString()}</span>
                                </div>
                            </div>
                            <div>
                                <div style="font-size: 0.9rem; color: var(--text-muted);">
                                    <p><strong>Total Assets:</strong> ${assets.length}</p>
                                    <p><strong>Average Salary:</strong> $${Math.round(monthlyCosts / assets.length || 0).toLocaleString()}</p>
                                    <p><strong>Treasury Runway:</strong> ${monthlyIncome > 0 ? Math.floor(currentFunds / monthlyCosts) + ' months' : 'Indefinite'}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
            } catch (error) {
                console.error('Failed to load treasury management:', error);
            }
        }
        
        // Asset Editor Functions
        function editAsset(assetId) {
            if (assetId && assetId !== 'new') {
                // Load existing asset
                intelligenceAPI.loadAssets().then(assets => {
                    const asset = assets.find(a => a.asset_id === assetId);
                    if (asset) {
                        loadAssetIntoEditor(asset);
                        currentEditingAsset = asset;
                    }
                });
            } else {
                // Create new asset
                clearAssetEditor();
                currentEditingAsset = null;
            }
            
            document.getElementById('assetEditorModal').classList.add('active');
        }
        
        function loadAssetIntoEditor(asset) {
            document.getElementById('assetRealName').value = asset.real_name || '';
            document.getElementById('assetCodename').value = asset.codename || '';
            document.getElementById('assetClassification').value = asset.classification || 'CONFIDENTIAL';
            document.getElementById('assetImageUrl').value = asset.image_url || '';
            document.getElementById('assetDescription').value = asset.description || '';
            document.getElementById('assetRealm').value = asset.location?.realm || 'Mortal Coil';
            document.getElementById('assetRegion').value = asset.location?.region || '';
            document.getElementById('assetMonthlySalary').value = asset.costs?.monthly_salary || 2500;
            document.getElementById('assetRecruitmentFee').value = asset.costs?.recruitment_fee || 5000;
            
            // Load stats
            const stats = asset.stats || {};
            ['skill', 'stealth', 'combat', 'tech', 'social', 'will'].forEach(stat => {
                const value = stats[stat] || 5;
                document.getElementById(`asset${stat.charAt(0).toUpperCase() + stat.slice(1)}`).value = value;
                updateAssetStatDisplay(stat);
            });
            
            // Load psychological stats
            const psych = asset.psychological || {};
            document.getElementById('assetLoyalty').value = psych.loyalty || 8;
            document.getElementById('assetCorruptionResist').value = psych.corruption_resistance || 7;
            document.getElementById('assetStressTolerance').value = psych.stress_tolerance || 6;
            
            // Update displays
            document.getElementById('assetLoyaltyDisplay').textContent = document.getElementById('assetLoyalty').value;
            document.getElementById('assetCorruptionResistDisplay').textContent = document.getElementById('assetCorruptionResist').value;
            document.getElementById('assetStressToleranceDisplay').textContent = document.getElementById('assetStressTolerance').value;
            
            // Load specializations and equipment
            assetSpecializations = asset.specializations || [];
            assetEquipment = asset.equipment || [];
            
            renderAssetSpecializations();
            renderAssetEquipment();
            updateAssetPreview();
        }
        
        function clearAssetEditor() {
            document.getElementById('assetEditorForm').reset();
            assetSpecializations = [];
            assetEquipment = [];
            
            // Reset stats to default values
            ['skill', 'stealth', 'combat', 'tech', 'social', 'will'].forEach(stat => {
                document.getElementById(`asset${stat.charAt(0).toUpperCase() + stat.slice(1)}`).value = 5;
                updateAssetStatDisplay(stat);
            });
            
            // Reset psychological displays
            document.getElementById('assetLoyaltyDisplay').textContent = '8';
            document.getElementById('assetCorruptionResistDisplay').textContent = '7';
            document.getElementById('assetStressToleranceDisplay').textContent = '6';
            
            renderAssetSpecializations();
            renderAssetEquipment();
            updateAssetPreview();
        }
        
        function updateAssetStatDisplay(statName) {
            const slider = document.getElementById(`asset${statName.charAt(0).toUpperCase() + statName.slice(1)}`);
            const display = document.getElementById(`asset${statName.charAt(0).toUpperCase() + statName.slice(1)}Value`);
            
            if (!slider || !display) return;
            
            display.textContent = slider.value;
            
            // Update color based on value
            const value = parseInt(slider.value);
            let color;
            if (value <= 3) color = '#ff3366';
            else if (value <= 6) color = '#ffa500';
            else color = '#00ff88';
            
            display.style.background = `linear-gradient(135deg, ${color}, ${color}aa)`;
            updateAssetPreview();
        }
        
        function addAssetSpecialization() {
            const input = document.getElementById('assetNewSpecialization');
            const spec = input.value.trim();
            
            if (spec && !assetSpecializations.includes(spec)) {
                assetSpecializations.push(spec);
                input.value = '';
                renderAssetSpecializations();
                updateAssetPreview();
            }
        }
        
        function removeAssetSpecialization(spec) {
            assetSpecializations = assetSpecializations.filter(s => s !== spec);
            renderAssetSpecializations();
            updateAssetPreview();
        }
        
        function renderAssetSpecializations() {
            const container = document.getElementById('assetSpecializationsList');
            container.innerHTML = assetSpecializations.map(spec => 
                `<span class="selected-asset-tag" style="cursor: pointer;" onclick="removeAssetSpecialization('${spec}')">${spec} </span>`
            ).join('');
        }
        
        function addAssetEquipment() {
            const input = document.getElementById('assetNewEquipment');
            const item = input.value.trim();
            
            if (item && !assetEquipment.includes(item)) {
                assetEquipment.push(item);
                input.value = '';
                renderAssetEquipment();
                updateAssetPreview();
            }
        }
        
        function removeAssetEquipment(item) {
            assetEquipment = assetEquipment.filter(e => e !== item);
            renderAssetEquipment();
            updateAssetPreview();
        }
        
        function renderAssetEquipment() {
            const container = document.getElementById('assetEquipmentList');
            container.innerHTML = assetEquipment.map(item => 
                `<div class="list-item" style="margin-bottom: 0.5rem;">
                    <span>${item}</span>
                    <span onclick="removeAssetEquipment('${item}')" style="cursor: pointer; color: var(--accent-red);"></span>
                </div>`
            ).join('');
        }
        
        function updateAssetPreview() {
            const preview = document.getElementById('assetPreviewCard');
            const realName = document.getElementById('assetRealName').value || 'New Asset';
            const codename = document.getElementById('assetCodename').value || 'Codename';
            const realm = document.getElementById('assetRealm').value;
            const region = document.getElementById('assetRegion').value || 'Unknown Location';
            const salary = document.getElementById('assetMonthlySalary').value;
            
            const stats = {};
            ['skill', 'stealth', 'combat', 'tech', 'social', 'will'].forEach(stat => {
                const element = document.getElementById(`asset${stat.charAt(0).toUpperCase() + stat.slice(1)}`);
                stats[stat] = element ? element.value : 5;
            });
            
            const totalStats = Object.values(stats).reduce((sum, val) => sum + parseInt(val), 0);
            const realmInfo = intelligenceAPI.getRealmInfo(realm);
            
            preview.innerHTML = `
                <div class="asset-card" style="background: rgba(0, 0, 0, 0.3); border: 1px solid var(--border-color); border-radius: 8px; padding: 1rem;">
                    <div class="asset-header" style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1rem;">
                        <div class="asset-info">
                            <div class="asset-name" style="font-size: 1.1rem; font-weight: 700; color: var(--text-primary); margin-bottom: 0.3rem;">${realName}</div>
                            <div class="asset-location" style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 0.3rem;">
                                <i class="${realmInfo.icon}" style="color: ${realmInfo.color};"></i>
                                ${realm} - ${region}
                            </div>
                            <div class="asset-location" style="font-size: 0.9rem; color: var(--text-secondary);">
                                <i class="fas fa-dollar-sign"></i> 
                                $${parseInt(salary || 0).toLocaleString()}/month
                            </div>
                        </div>
                        <div class="asset-status status-available" style="padding: 0.3rem 0.8rem; border-radius: 20px; font-size: 0.8rem; font-weight: 600; text-transform: uppercase; background: rgba(0, 255, 136, 0.2); color: var(--success); border: 1px solid var(--success);">AVAILABLE</div>
                    </div>
                    <div class="stats-grid" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.5rem; margin-top: 1rem;">
                        ${Object.entries(stats).map(([stat, value]) => `
                            <div class="stat-item" style="text-align: center; padding: 0.5rem; background: rgba(0, 0, 0, 0.3); border-radius: 6px; border: 1px solid var(--border-color);">
                                <span class="stat-value" style="display: block; font-size: 1.2rem; font-weight: 700; color: var(--accent-blue);">${value}</span>
                                <span class="stat-label" style="font-size: 0.7rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px;">${stat}</span>
                            </div>
                        `).join('')}
                    </div>
                    <div style="text-align: center; margin-top: 1rem; padding: 0.5rem; background: rgba(0, 212, 255, 0.1); border-radius: 6px;">
                        <strong>Total Stats: ${totalStats}</strong>
                    </div>
                    ${assetSpecializations.length > 0 ? `
                        <div style="margin-top: 1rem;">
                            <strong>Specializations:</strong> ${assetSpecializations.join(', ')}
                        </div>
                    ` : ''}
                    ${assetEquipment.length > 0 ? `
                        <div style="margin-top: 0.5rem;">
                            <strong>Equipment:</strong> ${assetEquipment.join(', ')}
                        </div>
                    ` : ''}
                </div>
            `;
        }
        
        async function saveAssetFromEditor() {
            if (!intelligenceAPI.canWrite()) {
                showNotification('GitHub authentication required', 'error');
                return;
            }
            
            try {
                const assetData = {
                    real_name: document.getElementById('assetRealName').value,
                    codename: document.getElementById('assetCodename').value || document.getElementById('assetRealName').value,
                    classification: document.getElementById('assetClassification').value,
                    image_url: document.getElementById('assetImageUrl').value,
                    description: document.getElementById('assetDescription').value,
                    location: {
                        realm: document.getElementById('assetRealm').value,
                        region: document.getElementById('assetRegion').value
                    },
                    stats: {},
                    costs: {
                        monthly_salary: parseInt(document.getElementById('assetMonthlySalary').value),
                        recruitment_fee: parseInt(document.getElementById('assetRecruitmentFee').value)
                    },
                    psychological: {
                        loyalty: parseInt(document.getElementById('assetLoyalty').value),
                        corruption_resistance: parseInt(document.getElementById('assetCorruptionResist').value),
                        stress_tolerance: parseInt(document.getElementById('assetStressTolerance').value)
                    },
                    specializations: assetSpecializations,
                    equipment: assetEquipment
                };
                
                // Collect stats
                ['skill', 'stealth', 'combat', 'tech', 'social', 'will'].forEach(stat => {
                    const element = document.getElementById(`asset${stat.charAt(0).toUpperCase() + stat.slice(1)}`);
                    assetData.stats[stat] = parseInt(element.value);
                });
                
                showNotification('Saving asset...', 'warning');
                
                if (currentEditingAsset) {
                    // Update existing asset
                    await intelligenceAPI.updateAsset(currentEditingAsset.asset_id, assetData);
                    showNotification(`Asset "${assetData.real_name}" updated successfully!`, 'success');
                } else {
                    // Create new asset
                    await intelligenceAPI.createAsset(assetData);
                    showNotification(`Asset "${assetData.real_name}" created successfully!`, 'success');
                }
                
                closeAssetEditor();
                await loadAllGMData();
                
            } catch (error) {
                console.error('Failed to save asset:', error);
                showNotification(`Failed to save asset: ${error.message}`, 'error');
            }
        }
        
        function closeAssetEditor() {
            document.getElementById('assetEditorModal').classList.remove('active');
            currentEditingAsset = null;
        }
        
        async function createNewAsset(event) {
            event.preventDefault();
            
            if (!intelligenceAPI || !intelligenceAPI.canWrite()) {
                showNotification('GitHub authentication required', 'error');
                return;
            }
            
            try {
                const formData = new FormData(event.target);
                const assetData = {
                    real_name: formData.get('real_name'),
                    codename: formData.get('codename') || formData.get('real_name'),
                    description: formData.get('description'),
                    location: {
                        realm: formData.get('realm'),
                        region: formData.get('region')
                    },
                    stats: {
                        skill: parseInt(formData.get('skill')),
                        stealth: parseInt(formData.get('stealth')),
                        combat: parseInt(formData.get('combat')),
                        tech: parseInt(formData.get('tech')),
                        social: parseInt(formData.get('social')),
                        will: parseInt(formData.get('will'))
                    },
                    costs: {
                        monthly_salary: parseInt(formData.get('monthly_salary'))
                    }
                };
                
                showNotification('Creating asset...', 'warning');
                const asset = await intelligenceAPI.createAsset(assetData);
                
                showNotification(`Asset "${asset.real_name}" created successfully!`, 'success');
                closeModal('assetModal');
                
                document.getElementById('assetForm').reset();
                await loadAllGMData();
                
            } catch (error) {
                console.error('Failed to create asset:', error);
                showNotification(`Failed to create asset: ${error.message}`, 'error');
            }
        }
        
        async function createNewMission(event) {
            event.preventDefault();
            
            if (!intelligenceAPI || !intelligenceAPI.canWrite()) {
                showNotification('GitHub authentication required', 'error');
                return;
            }
            
            try {
                const formData = new FormData(event.target);
                const missionData = {
                    codename: formData.get('codename'),
                    classification: formData.get('classification'),
                    objective: {
                        primary: formData.get('primary_objective')
                    },
                    target: {
                        location: {
                            realm: formData.get('target_realm')
                        }
                    },
                    risks: {
                        level: formData.get('risk_level')
                    },
                    timeline: {
                        estimated_duration_hours: parseInt(formData.get('duration_hours'))
                    },
                    deployment: {
                        status: formData.get('mission_status')
                    }
                };
                
                showNotification('Creating mission...', 'warning');
                const mission = await intelligenceAPI.createOperation(missionData);
                
                showNotification(`Mission "${mission.codename}" created successfully!`, 'success');
                closeModal('missionModal');
                
                document.getElementById('missionForm').reset();
                await loadAllGMData();
                
            } catch (error) {
                console.error('Failed to create mission:', error);
                showNotification(`Failed to create mission: ${error.message}`, 'error');
            }
        }
        
        async function adjustTreasury(event) {
            event.preventDefault();
            
            if (!intelligenceAPI || !intelligenceAPI.canWrite()) {
                showNotification('GitHub authentication required', 'error');
                return;
            }
            
            try {
                const formData = new FormData(event.target);
                const amount = parseInt(formData.get('amount'));
                const transactionType = formData.get('transaction_type');
                const reason = formData.get('reason');
                
                const gameState = await intelligenceAPI.loadGameState();
                const currentFunds = gameState.treasury?.current_funds || 0;
                
                let newFunds;
                if (transactionType === 'add') {
                    newFunds = currentFunds + amount;
                } else if (transactionType === 'subtract') {
                    newFunds = currentFunds - amount;
                } else if (transactionType === 'set') {
                    newFunds = amount;
                }
                
                showNotification('Updating treasury...', 'warning');
                await intelligenceAPI.updateGameState({
                    treasury: {
                        ...gameState.treasury,
                        current_funds: newFunds
                    }
                });
                
                showNotification(`Treasury updated: ${reason}`, 'success');
                closeModal('treasuryModal');
                
                document.getElementById('treasuryForm').reset();
                await loadTreasuryManagement();
                
            } catch (error) {
                console.error('Failed to adjust treasury:', error);
                showNotification(`Failed to adjust treasury: ${error.message}`, 'error');
            }
        }
        
        async function processPayroll() {
            if (!intelligenceAPI || !intelligenceAPI.canWrite()) {
                showNotification('GitHub authentication required', 'error');
                return;
            }
            
            try {
                const [gameState, assets] = await Promise.all([
                    intelligenceAPI.loadGameState(),
                    intelligenceAPI.loadAssets()
                ]);
                
                const totalPayroll = assets.reduce((sum, asset) => sum + (asset.costs?.monthly_salary || 0), 0);
                const currentFunds = gameState.treasury?.current_funds || 0;
                
                if (currentFunds < totalPayroll) {
                    showNotification('Insufficient funds for payroll!', 'error');
                    return;
                }
                
                if (confirm(`Process payroll of $${totalPayroll.toLocaleString()} for ${assets.length} assets?`)) {
                    showNotification('Processing payroll...', 'warning');
                    
                    await intelligenceAPI.updateGameState({
                        treasury: {
                            ...gameState.treasury,
                            current_funds: currentFunds - totalPayroll,
                            last_payroll_date: new Date().toISOString().split('T')[0]
                        }
                    });
                    
                    showNotification(`Payroll processed: $${totalPayroll.toLocaleString()} paid to ${assets.length} assets`, 'success');
                    await loadTreasuryManagement();
                }
                
            } catch (error) {
                console.error('Failed to process payroll:', error);
                showNotification(`Failed to process payroll: ${error.message}`, 'error');
            }
        }
        
        function generateRandomEvent() {
            const events = [
                'A rival intelligence network has been detected in your territory',
                'One of your assets has discovered a major supernatural threat',
                'Political tensions in the Never Never have escalated',
                'Local law enforcement is increasing scrutiny of unusual activities',
                'A new potential ally has approached the network',
                'Strange supernatural phenomena reported in the city'
            ];
            
            const randomEvent = events[Math.floor(Math.random() * events.length)];
            alert(`Random Event Generated:\n\n${randomEvent}\n\nConsider how this affects your ongoing operations and story.`);
        }
        
        function editMission(missionId) {
            showNotification('Mission editing interface coming soon!', 'warning');
            // TODO: Implement mission editing interface
        }
        
        function checkAuthAndRun(func) {
            if (!intelligenceAPI || !intelligenceAPI.canWrite()) {
                showNotification('GitHub authentication required for this action', 'warning');
                showTokenModal();
                return;
            }
            func();
        }
        
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }
        
        function showTokenModal() {
            const token = prompt('Enter your GitHub Personal Access Token:\n\n(Create one at GitHub Settings > Developer settings > Personal access tokens)\nNeeds "repo" scope for write access.');
            if (token) {
                intelligenceAPI.setGitHubToken(token);
                updateAuthStatus();
                showNotification('GitHub token saved successfully!', 'success');
            }
        }
        
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `<i class="fas fa-${type === 'success' ? 'check' : type === 'error' ? 'times' : 'exclamation-triangle'}"></i> ${message}`;
            
            document.body.appendChild(notification);
            
            setTimeout(() => notification.classList.add('show'), 100);
            
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, 4000);
        }
        
        async function refreshAllData() {
            showNotification('Refreshing all data...', 'warning');
            await loadAllGMData();
            showNotification('Data refreshed successfully!', 'success');
        }
        
        // Close modals when clicking outside
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal') || e.target.classList.contains('asset-editor-modal')) {
                e.target.classList.remove('active');
            }
        });
        
        // Enter key for password
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && !document.getElementById('passwordCheck').classList.contains('hidden')) {
                checkPassword();
            }
        });
        
        // Initialize asset preview when DOM loads
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize stat displays when the editor opens
            setTimeout(() => {
                if (document.getElementById('assetEditorModal')) {
                    ['skill', 'stealth', 'combat', 'tech', 'social', 'will'].forEach(stat => {
                        updateAssetStatDisplay(stat);
                    });
                    updateAssetPreview();
                }
            }, 100);
        });
    </script>
</body>
</html>
