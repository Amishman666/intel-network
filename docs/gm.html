<!DOCTYPE html>
<html lang="en">
<head>
    <!-- File Path: /docs/gm.html -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GM COMMAND CENTER // INTELLIGENCE NETWORK</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;600;700&display=swap');
        
        :root {
            --primary-bg: #0a0b0d;
            --secondary-bg: #1a1d23;
            --tertiary-bg: #252830;
            --accent-red: #ff3366;
            --accent-amber: #ffa500;
            --accent-blue: #00d4ff;
            --accent-green: #00ff88;
            --text-primary: #ffffff;
            --text-secondary: #b8bcc8;
            --text-muted: #6c7293;
            --border-color: #3d4147;
            --glow-red: 0 0 20px rgba(255, 51, 102, 0.3);
            --glow-blue: 0 0 20px rgba(0, 212, 255, 0.3);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Rajdhani', sans-serif;
            background: var(--primary-bg);
            color: var(--text-primary);
            overflow-x: hidden;
            min-height: 100vh;
            background-image: 
                radial-gradient(circle at 20% 50%, rgba(255, 51, 102, 0.03) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(0, 212, 255, 0.03) 0%, transparent 50%);
        }
        
        .header {
            background: linear-gradient(135deg, var(--secondary-bg) 0%, var(--tertiary-bg) 100%);
            border-bottom: 2px solid var(--accent-red);
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 1000;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.8);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1600px;
            margin: 0 auto;
        }
        
        .logo {
            font-family: 'Orbitron', monospace;
            font-size: 1.8rem;
            font-weight: 900;
            color: var(--accent-red);
            text-shadow: var(--glow-red);
            letter-spacing: 2px;
        }
        
        .nav-links {
            display: flex;
            gap: 1rem;
            align-items: center;
        }
        
        .nav-link {
            padding: 0.5rem 1rem;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .nav-link:hover {
            border-color: var(--accent-blue);
            color: var(--accent-blue);
            box-shadow: var(--glow-blue);
        }
        
        .nav-link.active {
            background: rgba(255, 51, 102, 0.1);
            border-color: var(--accent-red);
            color: var(--accent-red);
            box-shadow: var(--glow-red);
        }
        
        .header-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .auth-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 6px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .auth-status.authenticated {
            color: var(--accent-green);
            border: 1px solid var(--accent-green);
        }
        
        .auth-status.unauthenticated {
            color: var(--accent-red);
            border: 1px solid var(--accent-red);
        }
        
        .auth-status:hover {
            box-shadow: 0 0 15px rgba(255, 51, 102, 0.3);
        }
        
        .tab-nav {
            display: flex;
            gap: 0.5rem;
        }
        
        .tab-btn {
            padding: 0.5rem 1rem;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-secondary);
            cursor: pointer;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
        }
        
        .tab-btn:hover, .tab-btn.active {
            border-color: var(--accent-blue);
            color: var(--accent-blue);
            box-shadow: var(--glow-blue);
        }
        
        .main-container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }
        
        .panel {
            background: linear-gradient(135deg, var(--secondary-bg) 0%, var(--tertiary-bg) 100%);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(10px);
            position: relative;
        }
        
        .panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--accent-red), transparent);
        }
        
        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 1rem;
        }
        
        .panel-title {
            font-family: 'Orbitron', monospace;
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--accent-red);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 6px;
            font-family: 'Rajdhani', sans-serif;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--accent-red), #cc1144);
            color: white;
            border: 1px solid var(--accent-red);
        }
        
        .btn-primary:hover:not(:disabled) {
            box-shadow: var(--glow-red);
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: rgba(255, 165, 0, 0.1);
            color: var(--accent-amber);
            border: 1px solid var(--accent-amber);
        }
        
        .btn-success {
            background: rgba(0, 255, 136, 0.1);
            color: var(--accent-green);
            border: 1px solid var(--accent-green);
        }
        
        .btn-blue {
            background: linear-gradient(135deg, var(--accent-blue), #0099cc);
            color: white;
            border: 1px solid var(--accent-blue);
        }
        
        .btn-blue:hover:not(:disabled) {
            box-shadow: var(--glow-blue);
            transform: translateY(-2px);
        }
        
        .quick-action-card {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .quick-action-card:hover {
            border-color: var(--accent-red);
            box-shadow: 0 4px 20px rgba(255, 51, 102, 0.2);
        }
        
        .quick-action-card.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .quick-action-title {
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }
        
        .quick-action-desc {
            color: var(--text-muted);
            font-size: 0.9rem;
        }
        
        .form-group {
            margin-bottom: 1rem;
        }
        
        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 0.9rem;
        }
        
        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 0.75rem;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-primary);
            font-family: 'Rajdhani', sans-serif;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--accent-red);
            box-shadow: 0 0 10px rgba(255, 51, 102, 0.2);
        }
        
        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .stats-input-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: linear-gradient(135deg, var(--secondary-bg) 0%, var(--tertiary-bg) 100%);
            border: 2px solid var(--accent-red);
            border-radius: 12px;
            padding: 2rem;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 1rem;
        }
        
        .modal-title {
            font-family: 'Orbitron', monospace;
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--accent-red);
        }
        
        .close-btn {
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 1.5rem;
            cursor: pointer;
            transition: color 0.3s ease;
        }
        
        .close-btn:hover {
            color: var(--accent-red);
        }
        
        .asset-list, .mission-list {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            margin-bottom: 0.5rem;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .list-item:hover {
            border-color: var(--accent-red);
        }
        
        .item-name {
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .item-status {
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .status-available { background: rgba(0, 255, 136, 0.2); color: var(--accent-green); }
        .status-deployed { background: rgba(255, 165, 0, 0.2); color: var(--accent-amber); }
        .status-planning { background: rgba(0, 212, 255, 0.2); color: var(--accent-blue); }
        .status-active { background: rgba(255, 165, 0, 0.2); color: var(--accent-amber); }
        
        .auth-warning {
            background: rgba(255, 51, 102, 0.1);
            border: 1px solid var(--accent-red);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            text-align: center;
        }
        
        .notification {
            position: fixed;
            top: 100px;
            right: 20px;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            z-index: 3000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            background: var(--accent-green);
        }
        
        .notification.error {
            background: var(--accent-red);
        }
        
        .notification.warning {
            background: var(--accent-amber);
        }
        
        .password-check {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .password-check.hidden {
            display: none;
        }
        
        .password-form {
            background: linear-gradient(135deg, var(--secondary-bg) 0%, var(--tertiary-bg) 100%);
            border: 2px solid var(--accent-red);
            border-radius: 12px;
            padding: 2rem;
            max-width: 400px;
            width: 90%;
            text-align: center;
        }
        
        @media (max-width: 1200px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .nav-links {
                flex-wrap: wrap;
                gap: 0.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- Password Check Overlay -->
    <div class="password-check" id="passwordCheck">
        <div class="password-form">
            <div style="margin-bottom: 1.5rem;">
                <h2 style="color: var(--accent-red); font-family: 'Orbitron', monospace; margin-bottom: 0.5rem;">
                    <i class="fas fa-lock"></i> GM ACCESS REQUIRED
                </h2>
                <p style="color: var(--text-secondary);">Enter password to access Game Master controls</p>
            </div>
            <div style="margin-bottom: 1.5rem;">
                <input type="password" id="passwordInput" placeholder="Enter GM Password" 
                       style="width: 100%; padding: 1rem; background: rgba(0, 0, 0, 0.3); border: 1px solid var(--border-color); border-radius: 6px; color: var(--text-primary); font-family: 'Rajdhani', sans-serif; font-size: 1rem; text-align: center;">
            </div>
            <div style="display: flex; gap: 1rem;">
                <button onclick="checkPassword()" class="btn btn-primary" style="flex: 1;">
                    <i class="fas fa-unlock"></i> Access
                </button>
                <button onclick="goToPlayer()" class="btn btn-secondary">
                    <i class="fas fa-arrow-left"></i> Back to Player
                </button>
            </div>
        </div>
    </div>

    <header class="header">
        <div class="header-content">
            <div class="logo">
                <i class="fas fa-cog"></i> GM COMMAND CENTER
            </div>
            <nav class="nav-links">
                <a href="index.html" class="nav-link">Player Interface</a>
                <a href="intelligence-management.html" class="nav-link">Intelligence Manager</a>
                <span class="nav-link active">GM Access</span>
            </nav>
            <div class="header-controls">
                <div class="auth-status" id="authStatus" onclick="handleAuthClick()">
                    <i class="fas fa-lock"></i>
                    <span>Checking Auth...</span>
                </div>
                <div class="tab-nav">
                    <div class="tab-btn active" onclick="switchTab('dashboard')">Dashboard</div>
                    <div class="tab-btn" onclick="switchTab('assets')">Assets</div>
                    <div class="tab-btn" onclick="switchTab('missions')">Missions</div>
                    <div class="tab-btn" onclick="switchTab('treasury')">Treasury</div>
                </div>
            </div>
        </div>
    </header>
    
    <div class="main-container">
        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <div id="authWarning" class="auth-warning" style="display: none;">
                <h3 style="color: var(--accent-red); margin-bottom: 0.5rem;">
                    <i class="fas fa-exclamation-triangle"></i> Authentication Required
                </h3>
                <p style="margin-bottom: 1rem;">To create assets, missions, and modify game data, you need to authenticate with GitHub.</p>
                <button class="btn btn-primary" onclick="showTokenModal()">
                    <i class="fas fa-key"></i> Add GitHub Token
                </button>
            </div>
            
            <div class="dashboard-grid">
                <div class="panel">
                    <div class="panel-header">
                        <h2 class="panel-title"><i class="fas fa-bolt"></i> Quick Actions</h2>
                        <button class="btn btn-secondary" onclick="refreshAllData()">
                            <i class="fas fa-sync"></i> Refresh
                        </button>
                    </div>
                    
                    <div class="quick-action-card" onclick="checkAuthAndRun(() => openModal('assetModal'))">
                        <div class="quick-action-title">Create New Asset</div>
                        <div class="quick-action-desc">Recruit a new intelligence operative</div>
                    </div>
                    
                    <div class="quick-action-card" onclick="checkAuthAndRun(() => openModal('missionModal'))">
                        <div class="quick-action-title">Create New Mission</div>
                        <div class="quick-action-desc">Plan a new intelligence operation</div>
                    </div>
                    
                    <div class="quick-action-card" onclick="checkAuthAndRun(processPayroll)">
                        <div class="quick-action-title">Process Monthly Payroll</div>
                        <div class="quick-action-desc">Deduct monthly costs from treasury</div>
                    </div>
                    
                    <div class="quick-action-card" onclick="checkAuthAndRun(() => openModal('treasuryModal'))">
                        <div class="quick-action-title">Adjust Treasury</div>
                        <div class="quick-action-desc">Add/remove funds from network budget</div>
                    </div>
                    
                    <div class="quick-action-card" onclick="generateRandomEvent()">
                        <div class="quick-action-title">Generate Random Event</div>
                        <div class="quick-action-desc">Create story complications or opportunities</div>
                    </div>
                </div>
                
                <div class="panel">
                    <div class="panel-header">
                        <h2 class="panel-title"><i class="fas fa-clock"></i> Active Operations</h2>
                    </div>
                    
                    <div id="activeMissionsContainer">
                        <div style="text-align: center; color: var(--text-muted); padding: 2rem;">
                            <i class="fas fa-satellite-dish fa-spin fa-2x"></i>
                            <p style="margin-top: 1rem;">Loading active operations...</p>
                        </div>
                    </div>
                </div>
                
                <div class="panel">
                    <div class="panel-header">
                        <h2 class="panel-title"><i class="fas fa-users-cog"></i> Asset Status</h2>
                    </div>
                    
                    <div id="assetStatusContainer">
                        <div style="text-align: center; color: var(--text-muted); padding: 2rem;">
                            <i class="fas fa-satellite-dish fa-spin fa-2x"></i>
                            <p style="margin-top: 1rem;">Loading asset status...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Assets Tab -->
        <div id="assets" class="tab-content">
            <div class="panel">
                <div class="panel-header">
                    <h2 class="panel-title"><i class="fas fa-users"></i> Asset Management</h2>
                    <button class="btn btn-primary" onclick="checkAuthAndRun(() => openModal('assetModal'))">
                        <i class="fas fa-plus"></i> Create Asset
                    </button>
                </div>
                
                <div class="asset-list" id="assetManagementList">
                    <div style="text-align: center; color: var(--text-muted); padding: 2rem;">
                        <i class="fas fa-satellite-dish fa-spin fa-2x"></i>
                        <p style="margin-top: 1rem;">Loading assets...</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Missions Tab -->
        <div id="missions" class="tab-content">
            <div class="panel">
                <div class="panel-header">
                    <h2 class="panel-title"><i class="fas fa-crosshairs"></i> Mission Management</h2>
                    <button class="btn btn-primary" onclick="checkAuthAndRun(() => openModal('missionModal'))">
                        <i class="fas fa-plus"></i> Create Mission
                    </button>
                </div>
                
                <div class="mission-list" id="missionManagementList">
                    <div style="text-align: center; color: var(--text-muted); padding: 2rem;">
                        <i class="fas fa-satellite-dish fa-spin fa-2x"></i>
                        <p style="margin-top: 1rem;">Loading missions...</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Treasury Tab -->
        <div id="treasury" class="tab-content">
            <div class="panel">
                <div class="panel-header">
                    <h2 class="panel-title"><i class="fas fa-dollar-sign"></i> Treasury Management</h2>
                    <div>
                        <button class="btn btn-secondary" onclick="checkAuthAndRun(processPayroll)" style="margin-right: 1rem;">
                            <i class="fas fa-calculator"></i> Process Payroll
                        </button>
                        <button class="btn btn-primary" onclick="checkAuthAndRun(() => openModal('treasuryModal'))">
                            <i class="fas fa-plus"></i> Adjust Funds
                        </button>
                    </div>
                </div>
                
                <div id="treasuryDisplay">
                    <div style="text-align: center; color: var(--text-muted); padding: 2rem;">
                        <i class="fas fa-satellite-dish fa-spin fa-2x"></i>
                        <p style="margin-top: 1rem;">Loading treasury data...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Asset Creation Modal -->
    <div class="modal" id="assetModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Create New Asset</h3>
                <button class="close-btn" onclick="closeModal('assetModal')">&times;</button>
            </div>
            
            <form id="assetForm" onsubmit="createNewAsset(event)">
                <div class="form-group">
                    <label class="form-label">Asset Name</label>
                    <input type="text" name="real_name" class="form-input" placeholder="Marcus Blackthorne" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Codename</label>
                    <input type="text" name="codename" class="form-input" placeholder="Blackthorne">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Location</label>
                    <select name="realm" class="form-select" required>
                        <option value="Mortal Coil">Mortal Coil</option>
                        <option value="Winter Court">Winter Court - Never Never</option>
                        <option value="Summer Court">Summer Court - Never Never</option>
                        <option value="Hell">Hell</option>
                        <option value="Abyss">Abyss</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Region</label>
                    <input type="text" name="region" class="form-input" placeholder="Chicago, Illinois">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Stats (1-10)</label>
                    <div class="stats-input-grid">
                        <div>
                            <label class="form-label" style="margin-bottom: 0.25rem;">Skill</label>
                            <input type="number" name="skill" class="form-input" min="1" max="10" value="5" required>
                        </div>
                        <div>
                            <label class="form-label" style="margin-bottom: 0.25rem;">Stealth</label>
                            <input type="number" name="stealth" class="form-input" min="1" max="10" value="5" required>
                        </div>
                        <div>
                            <label class="form-label" style="margin-bottom: 0.25rem;">Combat</label>
                            <input type="number" name="combat" class="form-input" min="1" max="10" value="5" required>
                        </div>
                        <div>
                            <label class="form-label" style="margin-bottom: 0.25rem;">Tech</label>
                            <input type="number" name="tech" class="form-input" min="1" max="10" value="5" required>
                        </div>
                        <div>
                            <label class="form-label" style="margin-bottom: 0.25rem;">Social</label>
                            <input type="number" name="social" class="form-input" min="1" max="10" value="5" required>
                        </div>
                        <div>
                            <label class="form-label" style="margin-bottom: 0.25rem;">Will</label>
                            <input type="number" name="will" class="form-input" min="1" max="10" value="5" required>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Monthly Salary ($)</label>
                    <input type="number" name="monthly_salary" class="form-input" placeholder="2500" value="2500">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea name="description" class="form-textarea" placeholder="Background, abilities, and quirks..."></textarea>
                </div>
                
                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    <i class="fas fa-plus"></i> Create Asset
                </button>
            </form>
        </div>
    </div>
    
    <!-- Mission Creation Modal -->
    <div class="modal" id="missionModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Create New Mission</h3>
                <button class="close-btn" onclick="closeModal('missionModal')">&times;</button>
            </div>
            
            <form id="missionForm" onsubmit="createNewMission(event)">
                <div class="form-group">
                    <label class="form-label">Mission Codename</label>
                    <input type="text" name="codename" class="form-input" placeholder="OPERATION NIGHTFALL" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Classification</label>
                    <select name="classification" class="form-select" required>
                        <option value="CLASSIFIED">CLASSIFIED</option>
                        <option value="SECRET">SECRET</option>
                        <option value="TOP SECRET">TOP SECRET</option>
                        <option value="EYES ONLY">EYES ONLY</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Primary Objective</label>
                    <textarea name="primary_objective" class="form-textarea" placeholder="Infiltrate target location and gather intelligence..." required></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Target Realm</label>
                    <input type="text" name="target_realm" class="form-input" placeholder="Chicago Outfit Headquarters" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Risk Level</label>
                    <select name="risk_level" class="form-select" required>
                        <option value="LOW">LOW</option>
                        <option value="MEDIUM" selected>MEDIUM</option>
                        <option value="HIGH">HIGH</option>
                        <option value="EXTREME">EXTREME</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Estimated Duration (Hours)</label>
                    <input type="number" name="duration_hours" class="form-input" placeholder="72" value="72" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Mission Status</label>
                    <select name="mission_status" class="form-select" required>
                        <option value="PLANNING">PLANNING (Hidden from players)</option>
                        <option value="ACTIVE">ACTIVE (Visible to players)</option>
                    </select>
                </div>
                
                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    <i class="fas fa-plus"></i> Create Mission
                </button>
            </form>
        </div>
    </div>
    
    <!-- Treasury Modal -->
    <div class="modal" id="treasuryModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Adjust Treasury</h3>
                <button class="close-btn" onclick="closeModal('treasuryModal')">&times;</button>
            </div>
            
            <form id="treasuryForm" onsubmit="adjustTreasury(event)">
                <div class="form-group">
                    <label class="form-label">Amount ($)</label>
                    <input type="number" name="amount" class="form-input" placeholder="50000" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Transaction Type</label>
                    <select name="transaction_type" class="form-select" required>
                        <option value="add">Add Funds</option>
                        <option value="subtract">Subtract Funds</option>
                        <option value="set">Set Treasury To</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Reason</label>
                    <input type="text" name="reason" class="form-input" placeholder="Funding from benefactor..." required>
                </div>
                
                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    <i class="fas fa-dollar-sign"></i> Update Treasury
                </button>
            </form>
        </div>
    </div>
    
    <!-- Load dependencies -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js"></script>
    <script src="js/data-loader.js"></script>
    
    <script>
        // Password check on page load
        document.addEventListener('DOMContentLoaded', function() {
            checkGMAccess();
        });
        
        function checkGMAccess() {
            const hasAccess = sessionStorage.getItem('gmAccess') === 'true';
            if (!hasAccess) {
                document.getElementById('passwordCheck').classList.remove('hidden');
                document.getElementById('passwordInput').focus();
            } else {
                document.getElementById('passwordCheck').classList.add('hidden');
                initializeGMInterface();
            }
        }
        
        function checkPassword() {
            const password = document.getElementById('passwordInput').value;
            if (password === 'Lastdrop1@') {
                sessionStorage.setItem('gmAccess', 'true');
                document.getElementById('passwordCheck').classList.add('hidden');
                initializeGMInterface();
            } else {
                alert('Incorrect password. Access denied.');
                document.getElementById('passwordInput').value = '';
                document.getElementById('passwordInput').focus();
            }
        }
        
        function goToPlayer() {
            window.location.href = 'index.html';
        }
        
        async function initializeGMInterface() {
            try {
                updateAuthStatus();
                await loadAllGMData();
                
            } catch (error) {
                console.error('Failed to initialize GM interface:', error);
                showNotification('Failed to load data', 'error');
            }
        }
        
        function updateAuthStatus() {
            const authStatus = document.getElementById('authStatus');
            const authWarning = document.getElementById('authWarning');
            
            if (intelligenceAPI && intelligenceAPI.canWrite()) {
                authStatus.className = 'auth-status authenticated';
                authStatus.innerHTML = '<i class="fas fa-unlock"></i><span>Authenticated</span>';
                authWarning.style.display = 'none';
            } else {
                authStatus.className = 'auth-status unauthenticated';
                authStatus.innerHTML = '<i class="fas fa-lock"></i><span>Read-Only Mode</span>';
                authWarning.style.display = 'block';
            }
        }
        
        function handleAuthClick() {
            if (!intelligenceAPI || !intelligenceAPI.canWrite()) {
                showTokenModal();
            }
        }
        
        function switchTab(tabName) {
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(tabName).classList.add('active');
            
            // Load specific tab data
            if (tabName === 'assets') {
                loadAssetManagement();
            } else if (tabName === 'missions') {
                loadMissionManagement();
            } else if (tabName === 'treasury') {
                loadTreasuryManagement();
            }
        }
        
        async function loadAllGMData() {
            try {
                const [assets, operations, gameState] = await Promise.all([
                    intelligenceAPI.loadAssets(),
                    intelligenceAPI.loadOperations(),
                    intelligenceAPI.loadGameState()
                ]);
                
                await Promise.all([
                    loadDashboardData(assets, operations, gameState),
                    loadAssetManagement(),
                    loadMissionManagement(),
                    loadTreasuryManagement()
                ]);
                
                console.log('All GM data loaded successfully');
                
            } catch (error) {
                console.error('Failed to load GM data:', error);
                showNotification('Failed to load GM data', 'error');
            }
        }
        
        async function loadDashboardData(assets, operations, gameState) {
            // Load active missions
            const activeMissions = operations.filter(op => op.deployment?.status === 'ACTIVE');
            const activeMissionsContainer = document.getElementById('activeMissionsContainer');
            
            if (activeMissions.length === 0) {
                activeMissionsContainer.innerHTML = `
                    <div style="text-align: center; color: var(--text-muted); padding: 2rem;">
                        <i class="fas fa-clock"></i>
                        <p style="margin-top: 0.5rem;">No active operations</p>
                    </div>
                `;
            } else {
                activeMissionsContainer.innerHTML = activeMissions.map(mission => `
                    <div class="list-item">
                        <div>
                            <div class="item-name">${mission.codename}</div>
                            <div style="font-size: 0.8rem; color: var(--text-muted);">${mission.deployment?.assigned_assets?.length || 0} assets deployed</div>
                        </div>
                        <div class="item-status status-active">ACTIVE</div>
                    </div>
                `).join('');
            }
            
            // Load asset status summary
            const assetStatusContainer = document.getElementById('assetStatusContainer');
            const statusCounts = {
                available: assets.filter(a => a.status?.current === 'available').length,
                deployed: assets.filter(a => a.status?.current === 'deployed').length,
                injured: assets.filter(a => a.status?.current === 'injured').length
            };
            
            assetStatusContainer.innerHTML = `
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem; text-align: center;">
                    <div>
                        <div style="font-size: 1.5rem; font-weight: 700; color: var(--accent-green);">${statusCounts.available}</div>
                        <div style="font-size: 0.8rem; color: var(--text-muted);">Available</div>
                    </div>
                    <div>
                        <div style="font-size: 1.5rem; font-weight: 700; color: var(--accent-amber);">${statusCounts.deployed}</div>
                        <div style="font-size: 0.8rem; color: var(--text-muted);">Deployed</div>
                    </div>
                    <div>
                        <div style="font-size: 1.5rem; font-weight: 700; color: var(--accent-red);">${statusCounts.injured}</div>
                        <div style="font-size: 0.8rem; color: var(--text-muted);">Injured</div>
                    </div>
                </div>
            `;
        }
        
        async function loadAssetManagement() {
            try {
                const assets = await intelligenceAPI.loadAssets();
                const container = document.getElementById('assetManagementList');
                
                if (assets.length === 0) {
                    container.innerHTML = `
                        <div style="text-align: center; color: var(--text-muted); padding: 2rem;">
                            <i class="fas fa-users"></i>
                            <p style="margin-top: 0.5rem;">No assets created yet</p>
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = assets.map(asset => `
                    <div class="list-item" onclick="editAsset('${asset.asset_id}')">
                        <div>
                            <div class="item-name">${asset.real_name || asset.codename}</div>
                            <div style="font-size: 0.8rem; color: var(--text-muted);">
                                ${asset.location?.realm || 'Unknown'} - $${asset.costs?.monthly_salary || 0}/month
                            </div>
                        </div>
                        <div class="item-status status-${asset.status?.current || 'available'}">${(asset.status?.current || 'available').toUpperCase()}</div>
                    </div>
                `).join('');
                
            } catch (error) {
                console.error('Failed to load asset management:', error);
            }
        }
        
        async function loadMissionManagement() {
            try {
                const operations = await intelligenceAPI.loadOperations();
                const container = document.getElementById('missionManagementList');
                
                if (operations.length === 0) {
                    container.innerHTML = `
                        <div style="text-align: center; color: var(--text-muted); padding: 2rem;">
                            <i class="fas fa-crosshairs"></i>
                            <p style="margin-top: 0.5rem;">No missions created yet</p>
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = operations.map(mission => `
                    <div class="list-item" onclick="editMission('${mission.operation_id}')">
                        <div>
                            <div class="item-name">${mission.codename}</div>
                            <div style="font-size: 0.8rem; color: var(--text-muted);">
                                ${mission.target?.location?.realm || 'Unknown target'} - ${mission.risks?.level || 'MEDIUM'} risk
                            </div>
                        </div>
                        <div class="item-status status-${mission.deployment?.status?.toLowerCase() || 'planning'}">${mission.deployment?.status || 'PLANNING'}</div>
                    </div>
                `).join('');
                
            } catch (error) {
                console.error('Failed to load mission management:', error);
            }
        }
        
        async function loadTreasuryManagement() {
            try {
                const [gameState, assets] = await Promise.all([
                    intelligenceAPI.loadGameState(),
                    intelligenceAPI.loadAssets()
                ]);
                
                const currentFunds = gameState.treasury?.current_funds || 0;
                const monthlyIncome = gameState.treasury?.monthly_income || 0;
                const monthlyCosts = assets.reduce((sum, asset) => sum + (asset.costs?.monthly_salary || 0), 0);
                const netIncome = monthlyIncome - monthlyCosts;
                
                const container = document.getElementById('treasuryDisplay');
                container.innerHTML = `
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 2rem;">
                        <div style="text-align: center; padding: 1.5rem; background: rgba(0, 212, 255, 0.1); border-radius: 8px;">
                            <div style="font-size: 2rem; font-weight: 700; color: var(--accent-blue);">$${currentFunds.toLocaleString()}</div>
                            <div style="font-size: 0.9rem; color: var(--text-muted);">Current Treasury</div>
                        </div>
                        <div style="text-align: center; padding: 1.5rem; background: rgba(0, 255, 136, 0.1); border-radius: 8px;">
                            <div style="font-size: 2rem; font-weight: 700; color: ${netIncome >= 0 ? 'var(--accent-green)' : 'var(--accent-red)'};">$${netIncome.toLocaleString()}</div>
                            <div style="font-size: 0.9rem; color: var(--text-muted);">Monthly Net Income</div>
                        </div>
                    </div>
                    
                    <div style="background: rgba(0, 0, 0, 0.3); border-radius: 8px; padding: 1.5rem;">
                        <h3 style="color: var(--accent-amber); margin-bottom: 1rem;">Financial Breakdown</h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                    <span>Monthly Income:</span>
                                    <span style="color: var(--accent-green);">+$${monthlyIncome.toLocaleString()}</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                    <span>Asset Salaries:</span>
                                    <span style="color: var(--accent-red);">-$${monthlyCosts.toLocaleString()}</span>
                                </div>
                                <div style="border-top: 1px solid var(--border-color); padding-top: 0.5rem; display: flex; justify-content: space-between; font-weight: 700;">
                                    <span>Net Monthly:</span>
                                    <span style="color: ${netIncome >= 0 ? 'var(--accent-green)' : 'var(--accent-red)'};">${netIncome >= 0 ? '+' : ''}$${netIncome.toLocaleString()}</span>
                                </div>
                            </div>
                            <div>
                                <div style="font-size: 0.9rem; color: var(--text-muted);">
                                    <p><strong>Total Assets:</strong> ${assets.length}</p>
                                    <p><strong>Average Salary:</strong> $${Math.round(monthlyCosts / assets.length || 0).toLocaleString()}</p>
                                    <p><strong>Treasury Runway:</strong> ${monthlyIncome > 0 ? Math.floor(currentFunds / monthlyCosts) + ' months' : 'Indefinite'}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
            } catch (error) {
                console.error('Failed to load treasury management:', error);
            }
        }
        
        async function createNewAsset(event) {
            event.preventDefault();
            
            if (!intelligenceAPI || !intelligenceAPI.canWrite()) {
                showNotification('GitHub authentication required', 'error');
                return;
            }
            
            try {
                const formData = new FormData(event.target);
                const assetData = {
                    real_name: formData.get('real_name'),
                    codename: formData.get('codename') || formData.get('real_name'),
                    description: formData.get('description'),
                    location: {
                        realm: formData.get('realm'),
                        region: formData.get('region')
                    },
                    stats: {
                        skill: parseInt(formData.get('skill')),
                        stealth: parseInt(formData.get('stealth')),
                        combat: parseInt(formData.get('combat')),
                        tech: parseInt(formData.get('tech')),
                        social: parseInt(formData.get('social')),
                        will: parseInt(formData.get('will'))
                    },
                    costs: {
                        monthly_salary: parseInt(formData.get('monthly_salary'))
                    }
                };
                
                showNotification('Creating asset...', 'warning');
                const asset = await intelligenceAPI.createAsset(assetData);
                
                showNotification(`Asset "${asset.real_name}" created successfully!`, 'success');
                closeModal('assetModal');
                
                document.getElementById('assetForm').reset();
                await loadAllGMData();
                
            } catch (error) {
                console.error('Failed to create asset:', error);
                showNotification(`Failed to create asset: ${error.message}`, 'error');
            }
        }
        
        async function createNewMission(event) {
            event.preventDefault();
            
            if (!intelligenceAPI || !intelligenceAPI.canWrite()) {
                showNotification('GitHub authentication required', 'error');
                return;
            }
            
            try {
                const formData = new FormData(event.target);
                const missionData = {
                    codename: formData.get('codename'),
                    classification: formData.get('classification'),
                    objective: {
                        primary: formData.get('primary_objective')
                    },
                    target: {
                        location: {
                            realm: formData.get('target_realm')
                        }
                    },
                    risks: {
                        level: formData.get('risk_level')
                    },
                    timeline: {
                        estimated_duration_hours: parseInt(formData.get('duration_hours'))
                    },
                    deployment: {
                        status: formData.get('mission_status')
                    }
                };
                
                showNotification('Creating mission...', 'warning');
                const mission = await intelligenceAPI.createOperation(missionData);
                
                showNotification(`Mission "${mission.codename}" created successfully!`, 'success');
                closeModal('missionModal');
                
                document.getElementById('missionForm').reset();
                await loadAllGMData();
                
            } catch (error) {
                console.error('Failed to create mission:', error);
                showNotification(`Failed to create mission: ${error.message}`, 'error');
            }
        }
        
        async function adjustTreasury(event) {
            event.preventDefault();
            
            if (!intelligenceAPI || !intelligenceAPI.canWrite()) {
                showNotification('GitHub authentication required', 'error');
                return;
            }
            
            try {
                const formData = new FormData(event.target);
                const amount = parseInt(formData.get('amount'));
                const transactionType = formData.get('transaction_type');
                const reason = formData.get('reason');
                
                const gameState = await intelligenceAPI.loadGameState();
                const currentFunds = gameState.treasury?.current_funds || 0;
                
                let newFunds;
                if (transactionType === 'add') {
                    newFunds = currentFunds + amount;
                } else if (transactionType === 'subtract') {
                    newFunds = currentFunds - amount;
                } else if (transactionType === 'set') {
                    newFunds = amount;
                }
                
                showNotification('Updating treasury...', 'warning');
                await intelligenceAPI.updateGameState({
                    treasury: {
                        ...gameState.treasury,
                        current_funds: newFunds
                    }
                });
                
                showNotification(`Treasury updated: ${reason}`, 'success');
                closeModal('treasuryModal');
                
                document.getElementById('treasuryForm').reset();
                await loadTreasuryManagement();
                
            } catch (error) {
                console.error('Failed to adjust treasury:', error);
                showNotification(`Failed to adjust treasury: ${error.message}`, 'error');
            }
        }
        
        async function processPayroll() {
            if (!intelligenceAPI || !intelligenceAPI.canWrite()) {
                showNotification('GitHub authentication required', 'error');
                return;
            }
            
            try {
                const [gameState, assets] = await Promise.all([
                    intelligenceAPI.loadGameState(),
                    intelligenceAPI.loadAssets()
                ]);
                
                const totalPayroll = assets.reduce((sum, asset) => sum + (asset.costs?.monthly_salary || 0), 0);
                const currentFunds = gameState.treasury?.current_funds || 0;
                
                if (currentFunds < totalPayroll) {
                    showNotification('Insufficient funds for payroll!', 'error');
                    return;
                }
                
                if (confirm(`Process payroll of $${totalPayroll.toLocaleString()} for ${assets.length} assets?`)) {
                    showNotification('Processing payroll...', 'warning');
                    
                    await intelligenceAPI.updateGameState({
                        treasury: {
                            ...gameState.treasury,
                            current_funds: currentFunds - totalPayroll,
                            last_payroll_date: new Date().toISOString().split('T')[0]
                        }
                    });
                    
                    showNotification(`Payroll processed: $${totalPayroll.toLocaleString()} paid to ${assets.length} assets`, 'success');
                    await loadTreasuryManagement();
                }
                
            } catch (error) {
                console.error('Failed to process payroll:', error);
                showNotification(`Failed to process payroll: ${error.message}`, 'error');
            }
        }
        
        function generateRandomEvent() {
            const events = [
                'A rival intelligence network has been detected in your territory',
                'One of your assets has discovered a major supernatural threat',
                'Political tensions in the Never Never have escalated',
                'Local law enforcement is increasing scrutiny of unusual activities',
                'A new potential ally has approached the network',
                'Strange supernatural phenomena reported in the city'
            ];
            
            const randomEvent = events[Math.floor(Math.random() * events.length)];
            alert(`Random Event Generated:\n\n${randomEvent}\n\nConsider how this affects your ongoing operations and story.`);
        }
        
        function editAsset(assetId) {
            showNotification('Asset editing interface coming soon!', 'warning');
            // TODO: Implement asset editing interface
        }
        
        function editMission(missionId) {
            showNotification('Mission editing interface coming soon!', 'warning');
            // TODO: Implement mission editing interface
        }
        
        function checkAuthAndRun(func) {
            if (!intelligenceAPI || !intelligenceAPI.canWrite()) {
                showNotification('GitHub authentication required for this action', 'warning');
                showTokenModal();
                return;
            }
            func();
        }
        
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }
        
        function showTokenModal() {
            const token = prompt('Enter your GitHub Personal Access Token:\n\n(Create one at GitHub Settings > Developer settings > Personal access tokens)\nNeeds "repo" scope for write access.');
            if (token) {
                intelligenceAPI.setGitHubToken(token);
                updateAuthStatus();
                showNotification('GitHub token saved successfully!', 'success');
            }
        }
        
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `<i class="fas fa-${type === 'success' ? 'check' : type === 'error' ? 'times' : 'exclamation-triangle'}"></i> ${message}`;
            
            document.body.appendChild(notification);
            
            setTimeout(() => notification.classList.add('show'), 100);
            
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, 4000);
        }
        
        async function refreshAllData() {
            showNotification('Refreshing all data...', 'warning');
            await loadAllGMData();
            showNotification('Data refreshed successfully!', 'success');
        }
        
        // Close modals when clicking outside
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal')) {
                e.target.classList.remove('active');
            }
        });
        
        // Enter key for password
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && !document.getElementById('passwordCheck').classList.contains('hidden')) {
                checkPassword();
            }
        });
    </script>
</body>
</html>
